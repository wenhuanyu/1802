{"version":3,"sources":["uni-app:///main.js","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?fe6f","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?5f74","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?5f34","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?d766","uni-app:///pages/print/print.vue","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?c24f","webpack:///F:/xiangmu/1802/1802/pages/print/print.vue?0129"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,6F,6FAFmBA,EAAE,CAACC,iCAAH,GAAuCC,mBAAvC;AAGnBC,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACc;;;AAGlE;AAC0M;AAC1M,gBAAgB,iNAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAqyB,CAAgB,myBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC6BzzB;AACA;AACA;AACA,gE;;AAEA;AACA,MADA,kBACA;AACA;AACA,iBADA;AAEA,qBAFA;AAGA,kBAHA;AAIA,kBAJA;AAKA,2BALA;AAMA,0BANA;AAOA,4BAPA;AAQA,uBARA;;AAUA,iBAVA;AAWA,oBAXA;AAYA,iBAZA;AAaA,qBAbA,EAaA;AACA,kCAdA;AAeA,qBAfA;AAgBA,sBAhBA;AAiBA,iBAjBA;AAkBA,qBAlBA;AAmBA,0BAnBA;AAoBA,wBApBA;AAqBA,mBArBA;AAsBA,gBAtBA;AAuBA;AACA,kBAxBA;;AA0BA,GA5BA;AA6BA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAHA;;AAKA;AACA;AACA,eATA,MASA;AACA;AACA,6BADA;AAEA,uCAFA;;AAIA;AACA,aAlBA;;AAoBA,SAvBA;AAwBA;AACA;AACA;AACA,uBADA;AAEA,oCAFA;;AAIA,SA9BA;;AAgCA,KAvCA;AAwCA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CADA;AAEA;AACA;AACA;AACA,mBALA;;AAOA,eARA,MAQA;AACA;AACA;AACA,aAdA;;AAgBA;AACA;AACA,KAzEA;AA0EA;;;AAGA;AACA;AACA;AACA;AACA,qBADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,eAfA;;AAiBA,WAlBA,EAkBA,IAlBA;AAmBA,SAtBA;;AAwBA,KA5GA;AA6GA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAHA;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BADA;AAEA;AACA;AACA;AACA;AACA;AACA,SAPA;AAQA;AACA;AACA,uBADA;AAEA,2BAFA;;AAIA;AACA;AACA,SAfA;AAgBA;AACA;AACA,SAlBA,GADA;;AAqBA,KArJA;AAsJA;;;AAGA;AACA;AACA;AACA;AACA,kDADA;AAEA;AACA;AACA;AACA;AACA,SANA;AAOA;AACA;AACA,SATA;AAUA;AACA;AACA,SAZA;;AAcA,KA1KA;AA2KA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kDADA;AAEA,iCAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,qCAFA;;AAIA,aALA,MAKA;AACA;AACA;AACA,WAdA,MAcA;AACA;AACA;AACA,SA/CA;AAgDA;AACA;AACA,SAlDA;AAmDA;AACA;AACA;AACA;AACA,SAvDA;;AAyDA,KA9OA;AA+OA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,kDADA;AAEA,iDAFA;AAGA,yDAHA;AAIA,mBAJA;AAKA;AACA;AACA;AACA;AACA,WAHA;AAIA,SAVA;AAWA;AACA;AACA,SAbA;AAcA;AACA;AACA,SAhBA;;AAkBA,KAzQA;AA0QA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAtRA;AAuRA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,uBAXA,CAWA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA7BA,MA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAjBA,MAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA7BA,MA6BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAzBA,MAyBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OA/BA,MA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAnBA,MAmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAjBA,MAiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,KAhfA;AAifA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA/fA;AAggBA;;;AAGA;AACA;AACA;AACA;AACA,KAvgBA;AAwgBA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,mCANA,CAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OANA,MAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kDADA;AAEA,gDAFA;AAGA,wDAHA;AAIA,kBAJA;AAKA;AACA;AACA,SAPA;AAQA;AACA;AACA,SAVA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA,WAJA,MAIA;AACA;AACA,4BADA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAPA,MAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SApCA;;AAsCA,KA7kBA;AA8kBA;;;;;;;;AAQA;AACA,aAvlBA,uBAulBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OATA;;AAWA;AACA;AACA;AACA;AACA,OAJA;;AAMA;AACA;AACA;AACA,OAHA;AAIA;AACA,KA9mBA,EA7BA;;AA6oBA;AACA;AACA;AACA;AACA;AACA;AACA,4CANA,8IA7oBA;;AAqpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GA5pBA,E;;;;;;;;;;;;AClCA;AAAA;AAAA;AAAA;AAAs8C,CAAgB,63CAAG,EAAC,C;;;;;;;;;;;ACA19C;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/print/print.js","sourcesContent":["import 'uni-pages';wx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/print/print.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./print.vue?vue&type=template&id=30245762&\"\nvar renderjs\nimport script from \"./print.vue?vue&type=script&lang=js&\"\nexport * from \"./print.vue?vue&type=script&lang=js&\"\nimport style0 from \"./print.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/print/print.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./print.vue?vue&type=template&id=30245762&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./print.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./print.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <view class=\"pages\">\r\n      <!-- <view class=\"baozhuang_name\">物料名称：{{ printInfo.name }}</view> -->\r\n      <button style=\"background:#4B8EFF\" class=\"printbtn\" type=\"primary\" @click=\"searchBluetooth\" :loading=\"isScanning\">\r\n        1.开始搜索\r\n      </button>\r\n\r\n      <view class=\"device_list\">\r\n        <view v-for=\"(item, index) in devicesList\" @click=\"connectBluetoothSettings\" :data-index=\"index\"\r\n              class=\"device_item\">\r\n          <view class=\"deviceId\">\r\n            <view>deviceId:{{ item.deviceId }}</view>\r\n            <text v-if=\"show_id == item.deviceId\">已连接</text>\r\n          </view>\r\n          <div class=\"name\">name:{{ item.name }}</div>\r\n        </view>\r\n      </view>\r\n\r\n      <button style=\"background:#4B8EFF\" class=\"printbtn\" type=\"primary\" @click=\"labelTest\" :loading=\"isLabelSend\"\r\n              :disabled=\"isLabelSend\">2.标签打印\r\n      </button>\r\n\r\n      <canvas canvas-id=\"edit_area_canvas\"></canvas>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nconst app = getApp();\r\nlet tsc = require('../../gprint/tsc.js');\r\nlet esc = require('../../gprint/esc.js');\r\nlet util = require('../../gprint/hash.js');\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      show_id: '',\r\n      devicesList: [],\r\n      services: [],\r\n      serviceId: 0,\r\n      writeCharacter: false,\r\n      readCharacter: false,\r\n      notifyCharacter: false,\r\n      isScanning: false,\r\n\r\n      looptime: 0,\r\n      currentTime: 1,\r\n      lastData: 0,\r\n      oneTimeData: 20, //发送数据大小，测试正常，不能太多\r\n      returnResult: 'returnResult',\r\n      canvasWidth: 80,\r\n      canvasHeight: 80,\r\n      printNum: 1,\r\n      currentPrint: 1,\r\n      isReceiptSend: false,\r\n      isLabelSend: false,\r\n      printInfo: {},\r\n\t  option:{},\r\n      // boxNum: '',\r\n      labelNum: '',\r\n    };\r\n  },\r\n  methods: {\r\n    /**\r\n     * 蓝牙搜索\r\n     */\r\n    searchBluetooth: function () {\r\n      var that = this;\r\n      //判断蓝牙是否打开\r\n      wx.openBluetoothAdapter({\r\n        success: function (res) {\r\n          console.log(res);\r\n          wx.getBluetoothAdapterState({\r\n            success: function (res) {\r\n              console.log(res);\r\n              if (res.available) {\r\n                if (res.discovering) {\r\n                  wx.stopBluetoothDevicesDiscovery({\r\n                    success: function (res) {\r\n                      console.log(res);\r\n                    }\r\n                  });\r\n                }\r\n                that.checkPemission();\r\n              } else {\r\n                wx.showModal({\r\n                  title: '提示',\r\n                  content: '请开启手机蓝牙后再试'\r\n                });\r\n              }\r\n            }\r\n          });\r\n        },\r\n        fail: function (res) {\r\n          console.log(res);\r\n          wx.showModal({\r\n            title: '提示',\r\n            content: '蓝牙初始化失败，请打开蓝牙'\r\n          });\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * android 6.0以上需授权地理位置权限\r\n     */\r\n    checkPemission: function () {\r\n      var that = this;\r\n      var systemInfo = wx.getSystemInfoSync();\r\n      var platform = systemInfo.platform;\r\n      if (platform == 'ios') {\r\n        that.getBluetoothDevices();\r\n      } else if (platform == 'android') {\r\n        let system = systemInfo.system;\r\n        let system_no = system.replace('android', '');\r\n        system_no = system.replace('Android', '');\r\n        if (parseInt(system_no) > 5) {\r\n          console.log(123);\r\n          wx.getSetting({\r\n            success: function (res) {\r\n              console.log(res);\r\n              if (!res.authSetting['scope.userLocation']) {\r\n                wx.authorize({\r\n                  scope: 'scope.userLocation',\r\n                  complete: function (res) {\r\n                    console.log(res);\r\n                    that.getBluetoothDevices();\r\n                  }\r\n                });\r\n              } else {\r\n                that.getBluetoothDevices();\r\n              }\r\n            }\r\n          });\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * 获取蓝牙设备信息\r\n     */\r\n    getBluetoothDevices: function () {\r\n      var that = this;\r\n      console.log('start search');\r\n      wx.showLoading({\r\n        title: '正在加载'\r\n      });\r\n      that.isScanning = true;\r\n      wx.startBluetoothDevicesDiscovery({\r\n        success: function (res) {\r\n          console.log(res);\r\n          setTimeout(function () {\r\n            wx.getBluetoothDevices({\r\n              success: function (res) {\r\n                var devices = [];\r\n                var num = 0;\r\n                for (var i = 0; i < res.devices.length; ++i) {\r\n                  if (res.devices[i].name != '未知设备') {\r\n                    devices[num] = res.devices[i];\r\n                    num++;\r\n                  }\r\n                }\r\n                that.devicesList = devices;\r\n                that.isScanning = false;\r\n\r\n                wx.hideLoading();\r\n                wx.stopPullDownRefresh();\r\n              }\r\n            });\r\n          }, 3000);\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * 开始连接蓝牙设置\r\n     */\r\n    connectBluetoothSettings: function (e) {\r\n      var that = this;\r\n      let index = e.currentTarget.dataset.index;\r\n      let deviceId = that.devicesList[index].deviceId;\r\n      console.log(index);\r\n      wx.stopBluetoothDevicesDiscovery({\r\n        success: function (res) {\r\n          console.log(res);\r\n        }\r\n      });\r\n      that.serviceId = 0;\r\n      that.writeCharacter = false;\r\n      that.readCharacter = false;\r\n      that.notifyCharacter = false;\r\n      console.log(deviceId);\r\n      wx.showLoading({title: '请稍等'});\r\n      title: '正在连接',\r\n          wx.createBLEConnection({\r\n            deviceId: deviceId,\r\n            success: function (res) {\r\n              console.log(res);\r\n              app.globalData.bluetoothDeviceId = deviceId;\r\n              that.show_id = deviceId;\r\n              that.getBLEDeviceServices();\r\n            },\r\n            fail: function (e) {\r\n              wx.showModal({\r\n                title: '提示',\r\n                content: '连接失败'\r\n              });\r\n              console.log(e);\r\n              wx.hideLoading();\r\n            },\r\n            complete: function (e) {\r\n              console.log(e);\r\n            }\r\n          });\r\n    },\r\n    /**\r\n     * 获取蓝牙设备所有服务\r\n     */\r\n    getBLEDeviceServices: function () {\r\n      var that = this;\r\n      console.log(app.globalData.bluetoothDeviceId);\r\n      wx.getBLEDeviceServices({\r\n        deviceId: app.globalData.bluetoothDeviceId,\r\n        success: function (res) {\r\n          console.log(res);\r\n          that.services = res.services;\r\n          that.getBLEDeviceCharacteristics();\r\n        },\r\n        fail: function (e) {\r\n          console.log(e);\r\n        },\r\n        complete: function (e) {\r\n          console.log(e);\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * 获取蓝牙设备某个服务中所有特征值\r\n     */\r\n    getBLEDeviceCharacteristics: function () {\r\n      var that = this;\r\n      var list = that.services;\r\n      var num = that.serviceId;\r\n      var write = that.writeCharacter;\r\n      var read = that.readCharacter;\r\n      var notify = that.notifyCharacter;\r\n      wx.getBLEDeviceCharacteristics({\r\n        deviceId: app.globalData.bluetoothDeviceId,\r\n        serviceId: list[num].uuid,\r\n        success: function (res) {\r\n          console.log(res);\r\n          for (var i = 0; i < res.characteristics.length; ++i) {\r\n            var properties = res.characteristics[i].properties;\r\n            var item = res.characteristics[i].uuid;\r\n            if (!notify) {\r\n              if (properties.notify) {\r\n                app.globalData.notifyCharaterId = item;\r\n                app.globalData.notifyServiceId = list[num].uuid;\r\n                notify = true;\r\n              }\r\n            }\r\n            if (!write) {\r\n              if (properties.write) {\r\n                app.globalData.writeCharaterId = item;\r\n                app.globalData.writeServiceId = list[num].uuid;\r\n                write = true;\r\n              }\r\n            }\r\n            if (!read) {\r\n              if (properties.read) {\r\n                app.globalData.readCharaterId = item;\r\n                app.globalData.readServiceId = list[num].uuid;\r\n                read = true;\r\n              }\r\n            }\r\n          }\r\n          if (!write || !notify || !read) {\r\n            num++;\r\n            that.writeCharacter = write;\r\n            that.readCharacter = read;\r\n            that.notifyCharacter = notify;\r\n            that.serviceId = num;\r\n            if (num == list.length) {\r\n              wx.showModal({\r\n                title: '提示',\r\n                content: '找不到该读写的特征值'\r\n              });\r\n            } else {\r\n              that.getBLEDeviceCharacteristics();\r\n            }\r\n          } else {\r\n            that.notifyBLECharacteristicValueChange();\r\n          }\r\n        },\r\n        fail: function (e) {\r\n          console.log(e);\r\n        },\r\n        complete: function (e) {\r\n          console.log('write:' + app.globalData.writeCharaterId);\r\n          console.log('read:' + app.globalData.readCharaterId);\r\n          console.log('notify:' + app.globalData.notifyCharaterId);\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * 启用低功耗蓝牙设备特征值变化时的 notify 功能\r\n     */\r\n    notifyBLECharacteristicValueChange: function () {\r\n      console.log('deviceId:' + app.globalData.bluetoothDeviceId);\r\n      console.log('serviceId:' + app.globalData.notifyServiceId);\r\n      console.log('notifyCharaterId:' + app.globalData.notifyCharaterId);\r\n      wx.hideLoading();\r\n      wx.notifyBLECharacteristicValueChange({\r\n        deviceId: app.globalData.bluetoothDeviceId,\r\n        serviceId: app.globalData.notifyServiceId,\r\n        characteristicId: app.globalData.notifyCharaterId,\r\n        state: true,\r\n        success: function (res) {\r\n          wx.onBLECharacteristicValueChange(function (r) {\r\n            // console.log(`characteristic ${r.characteristicId} has changed, now is ${r}`)\r\n            console.log('onBLECharacteristicValueChange=', r);\r\n          });\r\n        },\r\n        fail: function (e) {\r\n          console.log('fail', e);\r\n        },\r\n        complete: function (e) {\r\n          console.log('complete', e);\r\n        }\r\n      });\r\n    },\r\n    /**\r\n     * 账单模式\r\n     */\r\n    sendData: function () {\r\n      var data = '好好学习，天天向上\\n';\r\n      var that = this;\r\n      var command = tsc.jpPrinter.createNew();\r\n      command.setGap(0);\r\n      command.setCls();\r\n      command.setText(40, 60, 'TSS24.BF2', 1, 1, data);\r\n      command.setPagePrint();\r\n      that.prepareSend(command.getData());\r\n    },\r\n    /**\r\n     * 标签模式\r\n     */\r\n    labelTest: function () {\r\n      var that = this;\r\n      let printInfo = that.printInfo;\r\n\t  console.log('printInfo',printInfo)\r\n      var canvasWidth = that.canvasWidth;\r\n      var canvasHeight = that.canvasHeight;\r\n      var command = tsc.jpPrinter.createNew();\r\n\t  \r\n   //    command.setSize(80, 40);\r\n   //    command.setGap(0);\r\n\t  // command.setLimitfeed(10)\r\n      command.setCls(); //需要设置这个，不然内容和上一次重复\r\n      // command.setText(210, 0, 'TSS24.BF2', 2, 2, printInfo.bar_code);\r\n      // command.setText(185, 0, 'TSS24.BF2', 2, 2, '1101-00252');\r\n      // command.setBar(180, 60, 128, 80, 0, 2, 2, printInfo.bar_code);\r\n      // command.setQR(240, 60, 'L', 7, 'A', 0, 'M2', 'S3', JSON.stringify({bar_code:printInfo.bar_code,number:that.number}));\r\n      // command.setQR(240, 60, 'L', 6, 'A', 0, 'M2', 'S3', printInfo.bar_code + ',' + that.boxNum + ',' + that.getMoment());\r\n\t  \r\n      // command.setText(100, 220, 'TSS24.BF2', 1, 1, `${printInfo.name}，${printInfo.specification}`);\r\n      // command.setText(100, 250, 'TSS24.BF2', 1, 1, `${printInfo.serial_num}/${printInfo.attribute}/标准`);\r\n      // command.setText(100, 280, 'TSS24.BF2', 1, 1, 'MADE IN CHINA');\r\n\t  \r\n\t  var line = '------------------------------------------------';\r\n\t  command.setText(40, 60, 'TSS24.BF2', 1, 1, `${printInfo.title}`);\r\n\t  command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  if(printInfo.text == 'luruyuzhi') {\r\n\t\t   command.setText(60, 90, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `已预支额：${printInfo.count_money}/（占总工程款${printInfo.rate}%)`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `预支金额：${printInfo.per_amount}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `金额大写：${printInfo.capital}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `卡号：${printInfo.bank_card}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `开户行：${printInfo.bank}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.pre_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `是否转账：${printInfo.transfer_text}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   if(printInfo.transfer_text == '是') {\r\n\t\t \tcommand.setText(330, 250, 'TSS24.BF2', 1, 1, `转账时间：${printInfo.zz_time}`);\r\n\t\t \tcommand.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   }\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `操作员：${printInfo.sign}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `签名：${printInfo.sign}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  } else if(printInfo.text == 'lurujisuan') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `工序：${printInfo.the_gongxu}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `亩：${printInfo.number}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `单价：${printInfo.unit_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.pre_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `总价：${printInfo.total_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  }  else if(printInfo.text == 'luruzhongzhuanche') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `磅单号：${printInfo.pounds_sn}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `中转车：${printInfo.car_zhong}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `毛重：${printInfo.cargo_weight}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `皮重：${printInfo.gros_weight}/（误差${printInfo.wucha.errors},平均误差${printInfo.wucha.average})`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `扣水份：${printInfo.k_moisture}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `净重：${printInfo.net_weight}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `日期：${printInfo.add_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `操作员：${printInfo.form_zhong_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `挖机：${printInfo.wj_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `油锯手：${printInfo.yjs_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `品名：${printInfo.pm_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `单位：T（吨）`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  }   else if(printInfo.text == 'lurudache') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `磅单号：${printInfo.pounds_sn}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `大车：${printInfo.car_da}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `净重：${printInfo.net_weight}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `出车时间：${printInfo.start_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `是否收单：${printInfo.shoudan_text}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t  if(printInfo.shoudan_text == '是') {\r\n\t\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `收单时间：${printInfo.single_time}`);\r\n\t\t\t    command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t  }\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `场地挖机：${printInfo.site_user_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `扣款：${printInfo.penalty}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `操作员：${printInfo.name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  } else if(printInfo.text == 'kanfayuzhi') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `职业：${printInfo.the_zhiye}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `已预支额：${printInfo.count_money}/（占总工程款${printInfo.rate}%)`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `预支金额：${printInfo.per_amount}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `金额大写：${printInfo.capital}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `卡号：${printInfo.bank_card}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `开户行：${printInfo.bank}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.pre_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `是否转账：${printInfo.transfer_text}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t  if(printInfo.transfer_text == '是') {\r\n\t\t\tcommand.setText(330, 250, 'TSS24.BF2', 1, 1, `转账时间：${printInfo.zz_time}`);\r\n\t\t\t command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t  }\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `操作员：${printInfo.sign}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `签名：${printInfo.sign}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  } else if(printInfo.text == 'luruwei') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `职业：${printInfo.the_zhiye}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.add_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `项目：${printInfo.project}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `数量：${printInfo.unit}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `单价：${printInfo.unit_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `总工程款：${printInfo.total_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  } else if(printInfo.text == 'lurubu') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `职业：${printInfo.the_zhiye}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.add_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `数量：${printInfo.number}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `单价：${printInfo.unit_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `合计：${printInfo.total_price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  } else if(printInfo.text == 'lurukou') {\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `姓名：${printInfo.the_name}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `职业：${printInfo.the_zhiye}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `林班号：${printInfo.quartel_account}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `时间：${printInfo.add_time}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `项目：${printInfo.project}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `金额：${printInfo.price}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `备注：${printInfo.note}`);\r\n\t\t   command.setText(330, 250, 'TSS24.BF2', 1, 1, `${line}`);\r\n\t  }\r\n\t  \r\n     \r\n\t  // command.setText(330, 280, 'TSS24.BF2', 1, 1, `日期（Date）：${that.getMoment()}`);\r\n      // command.setPagePrint(that.labelNum);\r\n      that.isLabelSend = true;\r\n      that.prepareSend(command.getData());\r\n    },\r\n    /**\r\n     * 准备发送数据\r\n     */\r\n    prepareSend: function (buff) {\r\n      console.log('buff', buff);\r\n      var that = this;\r\n      var time = that.oneTimeData;\r\n      var looptime = parseInt(buff.length / time);\r\n      var lastData = parseInt(buff.length % time);\r\n      console.log(looptime + '---' + lastData);\r\n      that.looptime = looptime + 1;\r\n      that.lastData = lastData;\r\n      that.currentTime = 1;\r\n      that.Send(buff);\r\n    },\r\n    /**\r\n     * 查询打印机状态\r\n     */\r\n    queryPrinterStatus: function () {\r\n      var command = esc.jpPrinter.Query();\r\n      command.getRealtimeStatusTransmission(1);\r\n      this.returnResult = '查询成功';\r\n    },\r\n    /**\r\n     * 分包发送\r\n     */\r\n    Send: function (buff) {\r\n      var that = this;\r\n      var currentTime = that.currentTime;\r\n      var loopTime = that.looptime;\r\n      var lastData = that.lastData;\r\n      var onTimeData = that.oneTimeData;\r\n      var printNum = that.printNum; //打印多少份\r\n      var currentPrint = that.currentPrint;\r\n      var buf;\r\n      var dataView;\r\n      if (currentTime < loopTime) {\r\n        buf = new ArrayBuffer(onTimeData);\r\n        dataView = new DataView(buf);\r\n        for (var i = 0; i < onTimeData; ++i) {\r\n          dataView.setUint8(i, buff[(currentTime - 1) * onTimeData + i]);\r\n        }\r\n      } else {\r\n        buf = new ArrayBuffer(lastData);\r\n        dataView = new DataView(buf);\r\n        for (var i = 0; i < lastData; ++i) {\r\n          dataView.setUint8(i, buff[(currentTime - 1) * onTimeData + i]);\r\n        }\r\n      }\r\n      console.log('第' + currentTime + '次发送数据大小为：' + buf.byteLength);\r\n      console.log('deviceId:' + app.globalData.bluetoothDeviceId);\r\n      console.log('serviceId:' + app.globalData.writeServiceId);\r\n      console.log('characteristicId:' + app.globalData.writeCharaterId);\r\n\r\n      wx.writeBLECharacteristicValue({\r\n        deviceId: app.globalData.bluetoothDeviceId,\r\n        serviceId: app.globalData.writeServiceId,\r\n        characteristicId: app.globalData.writeCharaterId,\r\n        value: buf,\r\n        success: function (res) {\r\n          console.log('写入成功', res);\r\n        },\r\n        fail: function (e) {\r\n          console.error('写入失败', e);\r\n        },\r\n        complete: function () {\r\n          currentTime++;\r\n          if (currentTime <= loopTime) {\r\n            that.currentTime = currentTime;\r\n\t\t\tconsole.log('buff',buff)\r\n            that.Send(buff);\r\n          } else {\r\n            wx.showToast({\r\n              title: '打印成功！'\r\n            });\r\n            if (currentPrint == printNum) {\r\n              that.looptime = 0;\r\n              that.lastData = 0;\r\n              that.currentTime = 1;\r\n              that.isReceiptSend = false;\r\n              that.isLabelSend = false;\r\n              that.currentPrint = 1;\r\n            } else {\r\n              currentPrint++;\r\n              that.currentPrint = currentPrint;\r\n              that.currentTime = 1;\r\n              console.log('开始打印');\r\n              that.Send(buff);\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    /** 格式 YYYY/yyyy/YY/yy 表示年份\r\n     * MM/M 月份\r\n     * W/w 星期\r\n     * dd/DD/d/D 日期\r\n     * hh/HH/h/H 时间\r\n     * mm/m 分钟\r\n     * ss/SS/s/S 秒\r\n     **/\r\n    //---------------------------------------------------\r\n    getMoment() {\r\n      const formatTime = date => {\r\n        const year = date.getFullYear()\r\n        const month = date.getMonth() + 1\r\n        const day = date.getDate()\r\n        const hour = date.getHours()\r\n        const minute = date.getMinutes()\r\n        const second = date.getSeconds()\r\n\r\n        return `${[year, month, day].map(formatNumber).join('-')}`\r\n      }\r\n\r\n      const getNowDate = date => {\r\n        const year = date.getFullYear()\r\n        const month = date.getMonth() + 1\r\n        return [year, month].map(formatNumber).join('-')\r\n      }\r\n\r\n      const formatNumber = n => {\r\n        n = n.toString()\r\n        return n[1] ? n : `0${n}`\r\n      }\r\n      return formatTime(new Date())\r\n    }\r\n  },\r\n  onLoad: async function (options) {\r\n\t  this.option = JSON.parse(decodeURIComponent(options.data))\r\n\t  console.log('option',this.option)\r\n    // this.boxNum = options.boxNum;\r\n    this.labelNum = this.option.labelNum;\r\n    this.printInfo = this.option;\r\n    console.log(this.getMoment())\r\n  },\r\n  onUnload: function () {\r\n    // wx.closeBLEConnection({\r\n    // \tdeviceId: app.globalData.bluetoothDeviceId,\r\n    // \tsuccess(res) {\r\n    // \t\tapp.globalData.bluetoothDeviceId = '';\r\n    // \t}\r\n    // });\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  background-color: #edf0f5;\r\n}\r\n\r\n.pages {\r\n  margin: 20px;\r\n}\r\n\r\n.printbtn {\r\n  margin-top: 20px;\r\n  width: 100%;\r\n  height: 80rpx;\r\n  border-radius: 66rpx;\r\n  background-color: #42c1ac;\r\n  color: white;\r\n  text-align: center;\r\n  line-height: 80rpx;\r\n}\r\n\r\n.text {\r\n  margin-top: 20px;\r\n}\r\n\r\n.input {\r\n  background-color: #fff;\r\n  height: 80rpx;\r\n  margin-top: 20px;\r\n  padding: 10px;\r\n}\r\n\r\n.device_list {\r\n  margin: 20px 5px;\r\n  border-radius: 5px;\r\n  width: auto;\r\n}\r\n\r\n.device_item {\r\n  border: 1px solid #aaa;\r\n  padding: 10px;\r\n  color: #666;\r\n}\r\n\r\n.device_item div {\r\n  display: block;\r\n}\r\n\r\n.deviceId {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n}\r\n\r\n.deviceId text {\r\n  color: #4b8eff;\r\n  font-size: 24rpx;\r\n  white-space: nowrap;\r\n  margin-left: 20rpx;\r\n}\r\n\r\n.baozhuang_name {\r\n  text-align: center;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./print.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./print.vue?vue&type=style&index=0&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1663320640264\n      var cssReload = require(\"F:/HBuilderX/HBuilderX.3.2.16.20211122/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}